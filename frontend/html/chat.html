<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WebSocket Chat</title>
</head>
<body>
  <div id="chat-container">
    <div id="chat-output"></div>
    <input type="text" id="message-input" placeholder="Digite sua mensagem...">
    <button onclick="sendMessage()">Enviar</button>
  </div>

  <script>
    var loc = window.location;
    //var endPoint = wsStart + loc.host + loc.pathname;
var host = loc.host.split(":")[0];

var serverBanco = loc.protocol+ '//' +host + ':8001';
var serverWebsocket =  host + ':8765';

var urlAtual = window.location.href;
var urlClass = new URL(urlAtual);
var tipo = urlClass.searchParams.get("tipo");
var peer1 = urlClass.searchParams.get("peer1");
var peer2 = urlClass.searchParams.get("peer2");
var userName = urlClass.searchParams.get("myUser");

var loc = window.location;
    var wsStart = 'ws://';

    if(loc.protocol == 'https:'){
        wsStart = 'wss://';
    }

    const socket = new WebSocket(wsStart+serverWebsocket+'/chat/'+peer1+peer2+peer1+peer2); // Substitua pelo endereço do seu servidor WebSocket

    socket.addEventListener('open', (event) => {
      console.log('Conexão estabelecida:', event);
      sendUserName();
    });

    socket.addEventListener('message', (event) => {
      const chatOutput = document.getElementById('chat-output');
      const message = document.createElement('p');
      message.textContent = event.data;
      chatOutput.appendChild(message);
    });

    socket.addEventListener('close', (event) => {
      console.log('Conexão fechada:', event);
    });

    function sendUserName() {
      // Envia o nome do usuário ao servidor quando a conexão é aberta
      socket.send(`Usuário "${userName}" entrou no chat.`);
    }

    function sendMessage() {
      const messageInput = document.getElementById('message-input');
      const message = messageInput.value;

      if (message.trim() !== '') {
        socket.send(`[${userName}]: ${message}`);
        messageInput.value = '';
      }
    }
  </script>
</body>
</html>
